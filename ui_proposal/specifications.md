# UI刷新プロジェクト仕様書

## 1. 概要

本仕様書は、要件定義書に基づき、新しいUIの具体的な画面設計、コンポーネントの動作、データフローを定義する。

## 2. 全体設計

- **フレームワーク**: フロントエンドはReactまたはVue.jsなどのモダンなJavaScriptフレームワークの利用を推奨。これにより、コンポーネントベースの開発とインタラクティブなUIの実現が容易になる。
- **チャートライブラリ**: インタラクティブなチャートは`Plotly.js`または`Chart.js`を利用する。バックエンドで生成したデータをフロントエンドで描画する。
- **API**: フロントエンドが必要なデータを取得するためのRESTful APIを設計する。非同期でデータを取得し、画面を更新する。

## 3. 画面仕様

### 3.1. 画面遷移図

```
                      +------------------------+
(アクセス) --------> |                        |       +------------------------+
                      |   サマリーページ       |-----> |                        |
                      |  (/index_new.html)     |       |   予測分析ページ       |
                      |                        |       |  (/predict?ticker=XXX) |
                      +--+------------------+--+       +------------------------+
                         |                  |
                         |                  |
                         |                  v
                         |      +------------------------+
                         |      |                        |
                         +----> |   リスク分析ページ     |
                                |  (/risk?ticker=XXX)    |
                                |                        |
                                +------------------------+
```

### 3.2. サマリーページ (`/index_new.html`)

**レイアウト**:
```
/--------------------------------------------------------------------\
| [ヘッダー: Market Report Neo]                                      |
|--------------------------------------------------------------------|
| # 本日のマーケットサマリー                                         |
|                                                                    |
|  /------------------\  /------------------\  /------------------\   |
|  | S&P 500          |  | NASDAQ           |  | DOW              |   |
|  | [ミニチャート]   |  | [ミニチャート]   |  | [ミニチャート]   |   |
|  | 2,800.50 (+0.5%) |  | 7,200.10 (-0.2%) |  | 25,000.00 (+0.1%)|   |
|  \------------------/  \------------------/  \------------------/   |
|                                                                    |
|--------------------------------------------------------------------|
| # AIによる市況コメント                                             |
| [ここにAIが生成したテキストが表示される...]                        |
|--------------------------------------------------------------------|
| # 主要銘柄の分析                                                   |
|                                                                    |
| [テーブル]                                                         |
| | 銘柄名 | 現在価格 | 1週間後予測 | リスク(VaR) | 詳細リンク | | |
| |--------|----------|-------------|-------------|------------| | |
| | AAPL   | 150.00   | 155.00 (▲)  | 2.5%        | [分析>>]   | | |
| | GOOGL  | 1200.00  | 1190.00 (▼)  | 3.1%        | [分析>>]   | | |
|                                                                    |
\--------------------------------------------------------------------/
```

**コンポーネント仕様**:
- **ミニチャート**: 過去24時間の価格推移を示すシンプルなラインチャート。
- **AIコメント**: `commentary_generator`が生成したテキストを表示。
- **主要銘柄テーブル**: `settings.yaml`で定義された主要銘柄のリストを表示。
  - **予測/リスク**: バックエンドの分析結果のサマリーを表示。
  - **詳細リンク**: クリックすると、その銘柄のティッカーをパラメータとして予測分析ページ(`/predict?ticker=...`)に遷移する。

### 3.3. 予測分析ページ (`/predict`)

**レイアウト**:
```
/--------------------------------------------------------------------
| [ヘッダー] < サマリーへ戻る                                        |
|--------------------------------------------------------------------|
| # 予測分析: [銘柄名 (ティッカー)]                                  |
|--------------------------------------------------------------------|
| [コントロールパネル]                                               |
|                                                                    |
| 予測モデル: [■ ARIMA] [☑ XGBoost] [☑ Ensemble]                     |
| 予測期間:   [〇 1週間] [● 1ヶ月] [〇 3ヶ月]                         |
| [分析実行ボタン]                                                   |
|--------------------------------------------------------------------|
| # 予測結果チャート                                                 |
|                                                                    |
|  (選択されたモデルの予測結果が重ねてプロットされたチャート)        |
|  (過去の実績データ + 未来の予測データ)                             |
|                                                                    |
|--------------------------------------------------------------------|
| # 精度評価                                                         |
|                                                                    |
| [テーブル]                                                         |
| | モデル名  | RMSE   | MAPE   | R^2    |                           |
| |-----------|--------|--------|--------|                           |
| | XGBoost   | 1.25   | 0.8%   | 0.95   |                           |
| | Ensemble  | 0.98   | 0.6%   | 0.98   |                           |
|                                                                    |
\--------------------------------------------------------------------
```

**コンポーネント仕様**:
- **コントロールパネル**: ユーザーが分析条件を選択する。
  - **モデル選択**: チェックボックスで複数のモデルを選択可能。
  - **分析実行**: ボタンクリックでAPIを呼び出し、分析結果を再取得・再描画する。
- **予測結果チャート**: `src/visualization/forecast_charts.py`が生成するデータを描画。
- **精度評価テーブル**: `src/analytics/forecasting/accuracy_evaluator.py`が計算した結果を表示。

## 4. データフロー

1.  **ページ読み込み**: ブラウザがページを要求。
2.  **静的コンテンツ返却**: WebサーバーがHTML, CSS, JSファイルを返す。
3.  **データ取得API呼び出し**: フロントエンドのJSが、デフォルトの分析結果（例: 主要銘柄の1ヶ月予測）を取得するAPI (`/api/predict/AAPL?period=1m`) を呼び出す。
4.  **バックエンド処理**: APIサーバーがリクエストを受け取り、`src/analytics`や`src/visualization`のモジュールを使って分析を実行。
5.  **JSONデータ返却**: 分析結果をJSON形式でフロントエンドに返す。
6.  **画面描画**: フロントエンドは受け取ったJSONデータを基に、チャートやテーブルを描画する。
7.  **ユーザー操作**: ユーザーがコントロールパネルで分析条件を変更し、「分析実行」ボタンをクリック。
8.  **API再呼び出し**: 変更された条件で再度API (`/api/predict/AAPL?period=3m&model=XGBoost`)を呼び出す。
9.  **画面更新**: 新しいJSONデータを受け取り、画面の一部（チャートとテーブル）を再描画する。
