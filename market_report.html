<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>米国マーケットレポート - 2025年07月14日</title>
    <link rel="stylesheet" href="static/style.css"> 
</head>
<body>
    <div class="container">
        <header>
            <h1>米国マーケットレポート</h1>
            <p class="report-date">2025年07月14日</p>
        </header>

        <section class="market-summary">
            <h2>主要指標</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>指標</th>
                            <th>直近値</th>
                            <th>前日比</th>
                            <th>変化率</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr>
                            <td>S&P500</td>
                            <td>6259.75</td>
                            <td>
                                
                                    <span class="negative">-20.71</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="negative">-0.33%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>NASDAQ100</td>
                            <td>22780.60</td>
                            <td>
                                
                                    <span class="negative">-48.66</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="negative">-0.21%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>ダウ30</td>
                            <td>44371.51</td>
                            <td>
                                
                                    <span class="negative">-279.13</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="negative">-0.63%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>SOX</td>
                            <td>5696.29</td>
                            <td>
                                
                                    <span class="negative">-11.99</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="negative">-0.21%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>米国2年金利</td>
                            <td>4.24</td>
                            <td>
                                
                                    -0.00
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="negative">-0.07%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>米国10年金利</td>
                            <td>4.42</td>
                            <td>
                                
                                    <span class="positive">0.08</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="positive">1.77%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>ドル円</td>
                            <td>146.29</td>
                            <td>
                                
                                    <span class="positive">0.17</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="positive">0.12%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>ユーロドル</td>
                            <td>1.17</td>
                            <td>
                                
                                    -0.00
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="negative">-0.24%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>ビットコイン</td>
                            <td>117516.99</td>
                            <td>
                                
                                    <span class="positive">1529.79</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="positive">1.32%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>ゴールド</td>
                            <td>3356.00</td>
                            <td>
                                
                                    <span class="positive">38.60</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="positive">1.16%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>原油</td>
                            <td>68.45</td>
                            <td>
                                
                                    <span class="positive">1.88</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="positive">2.82%</span>
                                    
                                
                            </td>
                        </tr>
                        
                        <tr>
                            <td>VIX</td>
                            <td>16.40</td>
                            <td>
                                
                                    <span class="positive">0.62</span>
                                    
                                
                                
                            </td>
                            <td>
                                
                                    <span class="positive">3.93%</span>
                                    
                                
                            </td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </section>

        <section class="economic-indicators">
            <h2>経済指標</h2>
            <h3>前日発表された経済指標</h3>
            
            <p>前日発表された経済指標はありません。</p>
            

            <h3>本日発表予定の経済指標</h3>
            
            <p>本日発表予定の経済指標はありません。</p>
            
        </section>

        <section class="sector-performance">
            <h2>米国セクターETF変化率</h2>
            
            <p>セクター別ETFのチャートは現在利用できません。</p>
            
        </section>

        <section class="charts">
            <h2>チャート</h2>
            
            <!-- Chart Customization Controls -->
            <div class="chart-controls">
                <h3>チャートカスタマイズ</h3>
                <div class="chart-options">
                    <div class="option-group">
                        <label for="maType">移動平均タイプ:</label>
                        <select id="maType">
                            <option value="SMA">単純移動平均 (SMA)</option>
                            <option value="EMA">指数移動平均 (EMA)</option>
                            <option value="WMA">加重移動平均 (WMA)</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label>表示する移動平均:</label>
                        <div class="ma-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="maShort" value="short" checked>
                                <span>25日線 (短期)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="maMedium" value="medium">
                                <span>50日線 (中期)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="maLong" value="long" checked>
                                <span>75日線 (長期)</span>
                            </label>
                        </div>
                    </div>
                    <div class="option-group">
                        <button id="updateCharts" type="button">チャートを更新</button>
                        <button id="resetCharts" type="button">デフォルトに戻す</button>
                    </div>
                </div>
            </div>
            
            
        </section>

        <section class="market-commentary">
            <h2>マーケットコメント</h2>
            <div class="commentary-content">
                <p>Test commentary</p>
            </div>
        </section>

        <section class="news">
            <h2>マーケットニュース</h2>
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="countryFilter">国でフィルター:</label>
                    <select id="countryFilter">
                        <option value="ALL">すべて</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="keywordFilter">キーワード検索:</label>
                    <input type="text" id="keywordFilter" placeholder="タイトルでキーワード検索...">
                </div>
                <div class="filter-group">
                    <button id="clearFilters" type="button">フィルターをクリア</button>
                </div>
            </div>
            
            <p>取得できるニュース記事はありませんでした。</p>
            
        </section>

        <footer>
            <p>&copy; 2025 米国マーケットレポート</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const chartSections = document.querySelectorAll('.chart-section');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabSection = this.closest('.chart-section');
                    const tabContents = tabSection.querySelectorAll('.tab-content');
                    const tabButtonsInSection = tabSection.querySelectorAll('.tab-button');

                    // Remove active class from all buttons in this section
                    tabButtonsInSection.forEach(btn => btn.classList.remove('active'));
                    // Add active class to the clicked button
                    this.classList.add('active');

                    // Hide all tab contents in this section
                    tabContents.forEach(content => content.classList.add('hidden'));

                    // Show the target tab content
                    const targetId = this.dataset.tabTarget;
                    const targetContent = tabSection.querySelector(`#${targetId}`);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                        // 画像のsrcを更新して再読み込みを強制
                        const imgElement = targetContent.querySelector('img');
                        console.log(`[DEBUG] Tab clicked: ${this.dataset.tabTarget}`);
                        console.log(`[DEBUG] imgElement found: ${!!imgElement}`);

                        if (imgElement) {
                            const originalDataSrc = targetContent.dataset.src.split('?')[0]; // data-srcから元のパスを取得
                            const cacheBuster = new Date().getTime();
                            const newSrc = `${originalDataSrc}?v=${cacheBuster}`;
                            
                            console.log(`[DEBUG] Original data-src: ${originalDataSrc}`);
                            console.log(`[DEBUG] New src with cache buster: ${newSrc}`);

                            imgElement.src = newSrc; // srcを更新
                            console.log(`[DEBUG] img.src set to: ${imgElement.src}`);
                        } else {
                            console.log("[DEBUG] imgElement not found for the target content.");
                        }
                    } else {
                        console.log(`[DEBUG] Target content not found for ID: ${targetId}`);
                    }
                });
            });

            // 初期表示時に各セクションの最初のタブをアクティブにする
            chartSections.forEach(section => {
                const firstButton = section.querySelector('.tab-button');
                if (firstButton) {
                    const targetId = firstButton.dataset.tabTarget;
                    const targetContent = section.querySelector(`#${targetId}`);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                        const imgElement = targetContent.querySelector('img');
                        if (imgElement) {
                            const originalDataSrc = targetContent.dataset.src.split('?')[0];
                            const cacheBuster = new Date().getTime();
                            imgElement.src = `${originalDataSrc}?v=${cacheBuster}`;
                        }
                    }
                }
            });

            /* ---------- News Table Sorting ---------- */
            const newsTable = document.querySelector('.news table');
            if (newsTable) {
                const headers = newsTable.querySelectorAll('th.sortable');
                headers.forEach((th, index) => {
                    th.addEventListener('click', () => {
                        const tbody = newsTable.querySelector('tbody');
                        const rows = Array.from(tbody.querySelectorAll('tr'));
                        const ascending = !(th.classList.contains('asc'));
                        headers.forEach(h => h.classList.remove('asc', 'desc'));
                        th.classList.add(ascending ? 'asc' : 'desc');
                        const type = th.dataset.type || 'string';
                        rows.sort((a, b) => {
                            const aText = a.children[index].textContent.trim();
                            const bText = b.children[index].textContent.trim();
                            if (type === 'date') {
                                return ascending ? (new Date(aText) - new Date(bText)) : (new Date(bText) - new Date(aText));
                            }
                            return ascending ? aText.localeCompare(bText) : bText.localeCompare(aText);
                        });
                        tbody.append(...rows);
                    });
                });
            }

            /* ---------- Enhanced News Filtering ---------- */
            if (newsTable) {
                const countryFilter = document.getElementById('countryFilter');
                const keywordFilter = document.getElementById('keywordFilter');
                const clearFiltersBtn = document.getElementById('clearFilters');
                const tbody = newsTable.querySelector('tbody');
                const visibleCountSpan = document.getElementById('visibleCount');
                const totalCountSpan = document.getElementById('totalCount');
                const allRows = Array.from(tbody.querySelectorAll('tr'));
                
                // Populate country filter options
                const countrySet = new Set();
                allRows.forEach(tr => {
                    const code = tr.children[1].textContent.trim();
                    countrySet.add(code);
                });
                [...countrySet].sort().forEach(code => {
                    const opt = document.createElement('option');
                    opt.value = code; 
                    opt.textContent = code;
                    countryFilter.appendChild(opt);
                });
                
                // Filter function
                function applyFilters() {
                    const selectedCountry = countryFilter.value;
                    const keyword = keywordFilter.value.toLowerCase().trim();
                    let visibleCount = 0;
                    
                    allRows.forEach(tr => {
                        const country = tr.dataset.country;
                        const title = tr.dataset.title;
                        
                        const countryMatch = selectedCountry === 'ALL' || country === selectedCountry;
                        const keywordMatch = !keyword || title.includes(keyword);
                        
                        const shouldShow = countryMatch && keywordMatch;
                        tr.style.display = shouldShow ? '' : 'none';
                        
                        if (shouldShow) visibleCount++;
                    });
                    
                    visibleCountSpan.textContent = visibleCount;
                }
                
                // Event listeners
                countryFilter.addEventListener('change', applyFilters);
                keywordFilter.addEventListener('input', debounce(applyFilters, 300));
                
                clearFiltersBtn.addEventListener('click', () => {
                    countryFilter.value = 'ALL';
                    keywordFilter.value = '';
                    applyFilters();
                });
                
                // Debounce function for keyword search
                function debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }
            }

            /* ---------- Chart Customization Controls ---------- */
            const updateChartsBtn = document.getElementById('updateCharts');
            const resetChartsBtn = document.getElementById('resetCharts');
            const maTypeSelect = document.getElementById('maType');
            const maCheckboxes = document.querySelectorAll('.ma-checkboxes input[type="checkbox"]');
            
            if (updateChartsBtn && resetChartsBtn) {
                // Update charts button
                updateChartsBtn.addEventListener('click', () => {
                    const selectedMaType = maTypeSelect.value;
                    const selectedMAs = Array.from(maCheckboxes)
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    
                    updateChartsBtn.disabled = true;
                    updateChartsBtn.textContent = '更新中...';
                    
                    // Display current settings (since actual regeneration would require server-side processing)
                    const settingsInfo = `移動平均設定: ${selectedMaType} - ${selectedMAs.map(ma => {
                        switch(ma) {
                            case 'short': return '25日線';
                            case 'medium': return '50日線';
                            case 'long': return '75日線';
                            default: return ma;
                        }
                    }).join(', ')}`;
                    
                    console.log(settingsInfo);
                    
                    // Show notification
                    showChartNotification('チャート設定が更新されました。実際の更新にはページの再読み込みが必要です。', 'info');
                    
                    setTimeout(() => {
                        updateChartsBtn.disabled = false;
                        updateChartsBtn.textContent = 'チャートを更新';
                    }, 1000);
                });
                
                // Reset charts button
                resetChartsBtn.addEventListener('click', () => {
                    maTypeSelect.value = 'SMA';
                    maCheckboxes.forEach(cb => {
                        cb.checked = cb.value === 'short' || cb.value === 'long';
                    });
                    showChartNotification('チャート設定をデフォルトに戻しました', 'success');
                });
            }
            
            // Chart notification function
            function showChartNotification(message, type = 'info') {
                // Remove existing notifications
                const existingNotification = document.querySelector('.chart-notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `chart-notification ${type}`;
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 4px;
                    z-index: 1000;
                    font-size: 0.9em;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                document.body.appendChild(notification);
                
                // Auto-remove after 3 seconds
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

        });
    </script>
</body>
</html>